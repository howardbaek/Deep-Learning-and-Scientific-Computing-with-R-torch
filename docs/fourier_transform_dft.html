<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-99.9.9">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Deep Learning and Scientific Computing with R torch - 26&nbsp; Exploring the Discrete Fourier Transform (DFT)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./fourier_transform_fft.html" rel="next">
<link href="./matrix_computations_convolution.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./other_overview.html">Other things to do with torch: Matrices, Fourier Transform, and Wavelets</a></li><li class="breadcrumb-item"><a href="./fourier_transform_dft.html"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Exploring the Discrete Fourier Transform (DFT)</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Deep Learning and Scientific Computing with R torch</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Getting familiar with torch</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basics_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Overview</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./what_is_torch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">On <code>torch</code>, and how to get it</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tensors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tensors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./autograd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Autograd</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./optim_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Function minimization with <em>autograd</em></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./network_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">A neural network from scratch</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modules.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Modules</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./optimizers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Optimizers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./loss_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Loss functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./optim_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Function minimization with L-BFGS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./network_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Modularizing the neural network</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Deep learning with torch</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dl_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Overview</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Loading data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./training_with_luz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Training with luz</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./image_classification_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">A first go at image classification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./overfitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Making models generalize</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./training_efficiency.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Speeding up training</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./image_classification_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Image classification, take two: Improving performance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./image_segmentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Image segmentation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tabular_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Tabular data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time_series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Time series</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./audio_classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Audio classification</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Other things to do with torch: Matrices, Fourier Transform, and Wavelets</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./other_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Overview</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./matrix_computations_leastsquares.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Matrix computations: Least-squares problems</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./matrix_computations_convolution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Matrix computations: Convolution</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fourier_transform_dft.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Exploring the Discrete Fourier Transform (DFT)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fourier_transform_fft.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">The Fast Fourier Transform (FFT)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wavelets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Wavelets</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#understanding-the-output-of-torch_fft_fft" id="toc-understanding-the-output-of-torch_fft_fft" class="nav-link active" data-scroll-target="#understanding-the-output-of-torch_fft_fft"><span class="header-section-number">26.1</span> Understanding the output of <code>torch_fft_fft()</code></a>
  <ul class="collapse">
  <li><a href="#starting-point-a-cosine-of-frequency-1" id="toc-starting-point-a-cosine-of-frequency-1" class="nav-link" data-scroll-target="#starting-point-a-cosine-of-frequency-1"><span class="header-section-number">26.1.1</span> Starting point: A cosine of frequency 1</a></li>
  <li><a href="#reconstructing-the-magic" id="toc-reconstructing-the-magic" class="nav-link" data-scroll-target="#reconstructing-the-magic"><span class="header-section-number">26.1.2</span> Reconstructing the magic</a></li>
  <li><a href="#varying-frequency" id="toc-varying-frequency" class="nav-link" data-scroll-target="#varying-frequency"><span class="header-section-number">26.1.3</span> Varying frequency</a></li>
  <li><a href="#varying-amplitude" id="toc-varying-amplitude" class="nav-link" data-scroll-target="#varying-amplitude"><span class="header-section-number">26.1.4</span> Varying amplitude</a></li>
  <li><a href="#adding-phase" id="toc-adding-phase" class="nav-link" data-scroll-target="#adding-phase"><span class="header-section-number">26.1.5</span> Adding phase</a></li>
  <li><a href="#superposition-of-sinusoids" id="toc-superposition-of-sinusoids" class="nav-link" data-scroll-target="#superposition-of-sinusoids"><span class="header-section-number">26.1.6</span> Superposition of sinusoids</a></li>
  </ul></li>
  <li><a href="#coding-the-dft" id="toc-coding-the-dft" class="nav-link" data-scroll-target="#coding-the-dft"><span class="header-section-number">26.2</span> Coding the DFT</a></li>
  <li><a href="#fun-with-sox" id="toc-fun-with-sox" class="nav-link" data-scroll-target="#fun-with-sox"><span class="header-section-number">26.3</span> Fun with <code>sox</code></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec:signal-processing-1" class="quarto-section-identifier"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Exploring the Discrete Fourier Transform (DFT)</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>This is the first chapter dedicated to the Fourier Transform, but it’s not the first time we’re encountering it. In the convolution chapter I mentioned, in passing, that the desired outcome is often more economically achieved in the Fourier domain, with convolution turning into multiplication. What’s more, we actually <em>made</em> <em>use</em> of the DFT in the chapter on audio classification. There, a call to <code>torchaudio</code>’s <code>transform_spectrogram()</code> triggered the computation of a whole bunch of Fourier Transforms, on a set of overlapping time windows constructed from the original input sequence.</p>
<p>In this chapter, we won’t content ourselves with purely calling the <code>torch</code>-provided functions. Instead, we’d like to get a feeling for what’s actually going on. To that purpose, we explore the ideas underlying Fourier analysis, and – in a straightforward, literal way – translate them into <code>torch</code>. In the subsequent chapter, building on the understanding we’ll have gained, we will then improve on performance by implementing one of the algorithms subsumed under the family of <em>Fast Fourier Transforms</em> (FFTs).</p>
<section id="understanding-the-output-of-torch_fft_fft" class="level2" data-number="26.1">
<h2 data-number="26.1" class="anchored" data-anchor-id="understanding-the-output-of-torch_fft_fft"><span class="header-section-number">26.1</span> Understanding the output of <code>torch_fft_fft()</code></h2>
<p>Our explorations take off hands-on: We call the main function associated with the (forward) Fourier Transform, <code>torch_fft_fft()</code> <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, and see if we can make sense of its output.</p>
<p>As we care about actual <em>understanding</em>, we start from the simplest possible example signal, a pure cosine that performs one revolution over the complete sampling period.</p>
<section id="starting-point-a-cosine-of-frequency-1" class="level3" data-number="26.1.1">
<h3 data-number="26.1.1" class="anchored" data-anchor-id="starting-point-a-cosine-of-frequency-1"><span class="header-section-number">26.1.1</span> Starting point: A cosine of frequency 1</h3>
<p>The way we set things up, there will be sixty-four samples; the sampling period thus equals <code>N = 64</code>. The content of <code>frequency()</code>, the below helper function used to construct the signal, reflects how we represent the cosine. Namely:</p>
<p><span class="math display">\[
f(x) = cos(\frac{2 \pi}{N} \ k \ x)
\]</span></p>
<p>Here <span class="math inline">\(x\)</span> values progress over time (or space), and <span class="math inline">\(k\)</span> is the <em>frequency index.</em> A cosine is periodic with period <span class="math inline">\(2 \pi\)</span>; so if we want it to first return to its starting state after sixty-four samples, and <span class="math inline">\(x\)</span> runs between zero and sixty-three, we’ll want <span class="math inline">\(k\)</span> to be equal to <span class="math inline">\(1\)</span>. Like that, we’ll reach the initial state again at position <span class="math inline">\(x = \frac{2 \pi}{64} * 1 * 64\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(torch)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">64</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>sample_positions <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>(N <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>frequency <span class="ot">&lt;-</span> <span class="cf">function</span>(k, N) {</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">/</span> N) <span class="sc">*</span> k</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">torch_cos</span>(<span class="fu">frequency</span>(<span class="dv">1</span>, N) <span class="sc">*</span> sample_positions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s quickly confirm this did what it was supposed to (<a href="#fig-dft-cos-1-rev">fig.&nbsp;<span>26.1</span></a>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> sample_positions, <span class="at">y =</span> <span class="fu">as.numeric</span>(x))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"time"</span>) <span class="sc">+</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"amplitude"</span>) <span class="sc">+</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-dft-cos-1-rev" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/dft-cos-1-rev.png" class="quarto-discovered-preview-image img-fluid figure-img" alt="A cosine function, starting with y=1 at x=0, and arriving at y=1 again at x=63."></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;26.1: Pure cosine that accomplishes one revolution over the complete sample period (64 samples).</figcaption><p></p>
</figure>
</div>
<p>Now that we have the input signal, <code>torch_fft_fft()</code> computes for us the Fourier coefficients, that is, the importance of the various frequencies present in the signal. The number of frequencies considered will equal the number of sampling points: So <span class="math inline">\(X\)</span> will be of length sixty-four as well.</p>
<p>(In our example, you’ll notice that the second half of coefficients will equal the first in magnitude.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> This is the case for every real-valued signal. In such cases, you could call <code>torch_fft_rfft()</code> instead, which yields “nicer” (in the sense of shorter) vectors to work with. Here though, I want to explain the general case, since that’s what you’ll find done in most expositions on the topic.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Ft <span class="ot">&lt;-</span> <span class="fu">torch_fft_fft</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Even with the signal being real, the Fourier coefficients are complex numbers. There are four ways to inspect them. The first is to extract the real part:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>real_part <span class="ot">&lt;-</span> Ft<span class="sc">$</span>real</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(real_part) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>[1]  0 32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
[29] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 
[57] 0 0 0 0 0 0 0 32</code></pre>
<p>Only a single coefficient is non-zero, the one at position 1. (We start counting from zero, and may discard the second half, as explained above.)</p>
<p>Now looking at the imaginary part, we find it is zero throughout:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>imag_part <span class="ot">&lt;-</span> Ft<span class="sc">$</span>imag</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(imag_part) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>[1]  0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
[29] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
[57] 0 0 0 0 0 0 0 0</code></pre>
<p>At this point we know that there is just a single frequency present in the signal, namely, that at <span class="math inline">\(k = 1\)</span>. This matches (and it better had to) the way we constructed the signal: namely, as accomplishing a single revolution over the complete sampling period.</p>
<p>Since, in theory, every coefficient could have non-zero real and imaginary parts, often what you’d report is the magnitude (the square root of the sum of squared real and imaginary parts):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>magnitude <span class="ot">&lt;-</span> <span class="fu">torch_abs</span>(Ft)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(magnitude) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>[1]  0 32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
[29] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 
[57] 0 0 0 0 0 0 0 32</code></pre>
<p>Unsurprisingly, these values exactly reflect the respective real parts.</p>
<p>Finally, there’s the phase, indicating a possible shift of the signal (a pure cosine is unshifted). In <code>torch</code>, we have <code>torch_angle()</code> complementing <code>torch_abs()</code>, but we need to take into account roundoff error here. We know that in each but a single case, the real and imaginary parts are both exactly zero; but due to finite precision in how numbers are presented in a computer, the actual values will often not be zero. Instead, they’ll be very small. If we take one of these “fake non-zeroes” and divide it by another, as happens in the angle calculation, big values can result. To prevent this from happening, our custom implementation rounds both inputs before triggering the division.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>phase <span class="ot">&lt;-</span> <span class="cf">function</span>(Ft, <span class="at">threshold =</span> <span class="fl">1e5</span>) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">torch_atan2</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">torch_abs</span>(<span class="fu">torch_round</span>(Ft<span class="sc">$</span>imag <span class="sc">*</span> threshold)),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">torch_abs</span>(<span class="fu">torch_round</span>(Ft<span class="sc">$</span>real <span class="sc">*</span> threshold))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fu">phase</span>(Ft)) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>[1]  0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
[29] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
[57] 0 0 0 0 0 0 0 0</code></pre>
<p>As expected, there is no phase shift in the signal.</p>
<p>Let’s visualize what we found (<a href="#fig-dft-cos-1-rev-dft">fig.&nbsp;<span>26.2</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>create_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, quantity) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x_ =</span> x,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_ =</span> <span class="fu">as.numeric</span>(y) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">5</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x_, <span class="at">y =</span> y_)) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"frequency"</span>) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(quantity) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>p_real <span class="ot">&lt;-</span> <span class="fu">create_plot</span>(</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  sample_positions,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  real_part,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"real part"</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>p_imag <span class="ot">&lt;-</span> <span class="fu">create_plot</span>(</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  sample_positions,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  imag_part,</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"imaginary part"</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>p_magnitude <span class="ot">&lt;-</span> <span class="fu">create_plot</span>(</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  sample_positions,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  magnitude,</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"magnitude"</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>p_phase <span class="ot">&lt;-</span> <span class="fu">create_plot</span>(</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  sample_positions,</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">phase</span>(Ft),</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"phase"</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>p_real <span class="sc">+</span> p_imag <span class="sc">+</span> p_magnitude <span class="sc">+</span> p_phase</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-dft-cos-1-rev-dft" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/dft-cos-1-rev-dft.png" class="img-fluid figure-img" alt="Top row: Left: Real part. y=32 at x=1 and x=63. Right: Imaginary part. All y=0. Bottom row: Left: Magnitude. y=32 at x=1 and x=63. Right: Phase. All y=0."></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;26.2: Real parts, imaginary parts, magnitudes and phases of the Fourier coefficients, obtained on a pure cosine that performs a single revolution over the sampling period. Imaginary parts as well as phases are all zero.</figcaption><p></p>
</figure>
</div>
<p>It’s fair to say that we have no reason to doubt what <code>torch_fft_fft()</code> has done. But with a pure sinusoid like this, we can understand exactly what’s going on by computing the DFT ourselves, by hand. Doing this now will significantly help us later, when we’re writing the code.</p>
</section>
<section id="reconstructing-the-magic" class="level3" data-number="26.1.2">
<h3 data-number="26.1.2" class="anchored" data-anchor-id="reconstructing-the-magic"><span class="header-section-number">26.1.2</span> Reconstructing the magic</h3>
<p>One caveat about this section. With a topic as rich as the Fourier Transform, and an audience who I imagine to vary widely on a dimension of math and sciences education, my chances to meet <em>your</em> expectations, dear reader, must be very close to zero. Still, I want to take the risk. If you’re an expert on these things, you’ll anyway be just scanning the text, looking out for pieces of <code>torch</code> code. If you’re moderately familiar with the DFT, you may still like being reminded of its inner workings. And – most importantly – if you’re rather new, or even completely new, to this topic, you’ll hopefully take away (at least) one thing: that what seems like one of the greatest wonders of the universe (assuming there is a reality somehow corresponding to what goes on in our minds) may well be a <em>wonder</em>, but neither “magic” nor a thing reserved to the initiated.</p>
<p>In a nutshell, the Fourier Transform is a <em>basis transformation</em>. In the case of the DFT – the Discrete Fourier Transform, where time and frequency representations both are finite vectors, not functions – the new basis looks like this:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\mathbf{w}^{0n}_N = e^{i\frac{2 \pi}{N}* 0 * n} = 1\\
&amp;\mathbf{w}^{1n}_N = e^{i\frac{2 \pi}{N}* 1 * n} = e^{i\frac{2 \pi}{N} n}\\
&amp;\mathbf{w}^{2n}_N = e^{i\frac{2 \pi}{N}* 2 * n} = e^{i\frac{2 \pi}{N}2n}\\&amp; ... \\
&amp;\mathbf{w}^{(N-1)n}_N = e^{i\frac{2 \pi}{N}* (N-1) * n} = e^{i\frac{2 \pi}{N}(N-1)n}\\
\end{aligned}
\]</span></p>
<p>Here <span class="math inline">\(N\)</span>, as before, is the number of samples (64, in our case); thus, there are <span class="math inline">\(N\)</span> basis vectors. With <span class="math inline">\(k\)</span> running through the basis vectors, they can be written:</p>
<p><span id="eq-dft-1"><span class="math display">\[
\mathbf{w}^{kn}_N = e^{i\frac{2 \pi}{N}k n}
\tag{26.1}\]</span></span></p>
<p>Like <span class="math inline">\(k\)</span>, <span class="math inline">\(n\)</span> runs from <span class="math inline">\(0\)</span> to <span class="math inline">\(N-1\)</span>. To understand what these basis vectors are doing, it is helpful to temporarily switch to a shorter sampling period, <span class="math inline">\(N = 4\)</span>, say. If we do so, we have four basis vectors: <span class="math inline">\(\mathbf{w}^{0n}_N\)</span>, <span class="math inline">\(\mathbf{w}^{1n}_N\)</span>, <span class="math inline">\(\mathbf{w}^{2n}_N\)</span>, and <span class="math inline">\(\mathbf{w}^{3n}_N\)</span>. The first one looks like this:</p>
<p><span class="math display">\[
\mathbf{w}^{0n}_N
=
\begin{bmatrix}
   e^{i\frac{2 \pi}{4}* 0 * 0}\\
   e^{i\frac{2 \pi}{4}* 0 * 1}\\
   e^{i\frac{2 \pi}{4}* 0 * 2}\\
   e^{i\frac{2 \pi}{4}* 0 * 3}
\end{bmatrix}
=
\begin{bmatrix}
   1\\
   1\\
   1\\
   1\\
\end{bmatrix}
\]</span></p>
<p>The second, like so:</p>
<p><span class="math display">\[
\mathbf{w}^{1n}_N
=
\begin{bmatrix}
   e^{i\frac{2 \pi}{4}* 1 * 0}\\
   e^{i\frac{2 \pi}{4}* 1 * 1}\\
   e^{i\frac{2 \pi}{4}* 1 * 2}\\
   e^{i\frac{2 \pi}{4}* 1 * 3}
\end{bmatrix}
=
\begin{bmatrix}
   1\\
   e^{i\frac{\pi}{2}}\\
   e^{i \pi}\\
   e^{i\frac{3 \pi}{4}}
\end{bmatrix}
=
\begin{bmatrix}
   1\\
   i\\
   -1\\
   -i\\
\end{bmatrix}
\]</span></p>
<p>This is the third:</p>
<p><span class="math display">\[
\mathbf{w}^{2n}_N
=
\begin{bmatrix}
   e^{i\frac{2 \pi}{4}* 2 * 0}\\
   e^{i\frac{2 \pi}{4}* 2 * 1}\\
   e^{i\frac{2 \pi}{4}* 2 * 2}\\
   e^{i\frac{2 \pi}{4}* 2 * 3}
\end{bmatrix}
=
\begin{bmatrix}
   1\\
   e^{i\pi}\\
   e^{i 2 \pi}\\
   e^{i\frac{3 \pi}{2}}
\end{bmatrix}
=
\begin{bmatrix}
   1\\
   -1\\
   1\\
   -1\\
\end{bmatrix}
\]</span></p>
<p>And finally, the fourth:</p>
<p><span class="math display">\[
\mathbf{w}^{3n}_N
=
\begin{bmatrix}
   e^{i\frac{2 \pi}{4}* 3 * 0}\\
   e^{i\frac{2 \pi}{4}* 3 * 1}\\
   e^{i\frac{2 \pi}{4}* 3 * 2}\\
   e^{i\frac{2 \pi}{4}* 3 * 3}
\end{bmatrix}
=
\begin{bmatrix}
   1\\
   e^{i\frac{3 \pi}{2}}\\
   e^{i 3 \pi}\\
   e^{i\frac{9 \pi}{2}}
\end{bmatrix}
=
\begin{bmatrix}
   1\\
   -i\\
   -1\\
   i\\
\end{bmatrix}
\]</span></p>
<p>We can characterize these four basis vectors in terms of their “speed”: how fast they move around the unit circle. To do this, we simply look at the rightmost column vectors, where the final calculation results appear. The values in that column correspond to positions pointed to by the revolving basis vector at different points in time. This means that looking at a single “update of position”, we can see how fast the vector is moving in a single time step.</p>
<p>Looking first at <span class="math inline">\(\mathbf{w}^{0n}_N\)</span>, we see that it does not move at all. <span class="math inline">\(\mathbf{w}^{1n}_N\)</span> goes from <span class="math inline">\(1\)</span> to <span class="math inline">\(i\)</span> to <span class="math inline">\(-1\)</span> to <span class="math inline">\(-i\)</span>; one more step, and it would be back where it started. That’s one revolution in four steps, or a step size of <span class="math inline">\(\frac{\pi}{2}\)</span>. Then <span class="math inline">\(\mathbf{w}^{2n}_N\)</span> goes at double that pace, moving a distance of <span class="math inline">\(\pi\)</span> along the circle. That way, it ends up completing two revolutions overall. Finally, <span class="math inline">\(\mathbf{w}^{3n}_N\)</span> achieves three complete loops, for a step size of <span class="math inline">\(\frac{3 \pi}{2}\)</span>.</p>
<p>The thing that makes these basis vectors so useful is that they are mutually orthogonal. That is, their dot product is zero:</p>
<p><span id="eq-dft-2"><span class="math display">\[
\langle \mathbf{w}^{kn}_N, \mathbf{w}^{ln}_N \rangle \ = \ \sum_{n=0}^{N-1} ({e^{i\frac{2 \pi}{N}k n}})^* e^{i\frac{2 \pi}{N}l n} = \ \sum_{n=0}^{N-1} ({e^{-i\frac{2 \pi}{N}k n}})e^{i\frac{2 \pi}{N}l n} = 0
\tag{26.2}\]</span></span></p>
<p>Let’s take, for example, <span class="math inline">\(\mathbf{w}^{2n}_N\)</span> and <span class="math inline">\(\mathbf{w}^{3n}_N\)</span>. Indeed, their dot product evaluates to zero.</p>
<p><span class="math display">\[
\begin{bmatrix}
   1 &amp; -1 &amp; 1 &amp; -1\\
\end{bmatrix}
\begin{bmatrix}
   1\\
   -i\\
   -1\\
   i\\
\end{bmatrix}
=
1 + i + (-1) + (-i)  = 0
\]</span></p>
<p>Now, we’re about to see how the orthogonality of the Fourier basis substantially simplifies the calculation of the DFT. Did you notice the similarity between these basis vectors and the way we wrote the example signal? Here it is again:</p>
<p><span class="math display">\[
f(x) = cos(\frac{2 \pi}{N} k x)
\]</span></p>
<p>If we manage to represent this function in terms of the basis vectors <span class="math inline">\(\mathbf{w}^{kn}_N = e^{i\frac{2 \pi}{N}k n}\)</span>, the inner product between the function and each basis vector will be either zero (the “default”) or a multiple of one (in case the function has a component matching the basis vector in question). Luckily, sines and cosines can easily be converted into complex exponentials. In our example, this is how that goes:<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<p><span class="math display">\[
\begin{aligned}
\mathbf{x}_n &amp;= cos(\frac{2 \pi}{64} n) \\
&amp;= \frac{1}{2} (e^{i\frac{2 \pi}{64} n} + e^{-i\frac{2 \pi}{64} n}) \\
&amp;= \frac{1}{2} (e^{i\frac{2 \pi}{64} n} + e^{i\frac{2 \pi}{64} 63n}) \\
&amp;= \frac{1}{2} (\mathbf{w}^{1n}_N + \mathbf{w}^{63n}_N)
\end{aligned}
\]</span></p>
<p>Here the first step directly results from Euler’s formula<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>, and the second reflects the fact that the Fourier coefficients are periodic, with frequency -1 being the same as 63, -2 equaling 62, and so on.</p>
<p>Now, the <span class="math inline">\(k\)</span>th Fourier coefficient is obtained by projecting the signal onto basis vector <span class="math inline">\(k\)</span>.</p>
<p>Due to the orthogonality of the basis vectors, only two coefficients will not be zero: those for <span class="math inline">\(\mathbf{w}^{1n}_N\)</span> and <span class="math inline">\(\mathbf{w}^{63n}_N\)</span>. They are obtained by computing the inner product between the function and the basis vector in question, that is, by summing over <span class="math inline">\(n\)</span>. For each <span class="math inline">\(n\)</span> ranging between <span class="math inline">\(0\)</span> and <span class="math inline">\(N-1\)</span>, we have a contribution of <span class="math inline">\(\frac{1}{2}\)</span>, leaving us with a final sum of <span class="math inline">\(32\)</span> for both coefficients. For example, for <span class="math inline">\(\mathbf{w}^{1n}_N\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
X_1 &amp;= \langle \mathbf{w}^{1n}_N, \mathbf{x}_n \rangle \\
&amp;= \langle \mathbf{w}^{1n}_N, \frac{1}{2} (\mathbf{w}^{1n}_N + \mathbf{w}^{63n}_N) \rangle \\
&amp;= \frac{1}{2} * 64 \\
&amp;= 32
\end{aligned}
\]</span></p>
<p>And analogously for <span class="math inline">\(X_{63}\)</span>.</p>
<p>Now, looking back at what <code>torch_fft_fft()</code> gave us, we see we were able to arrive at the same result. And we’ve learned something along the way.</p>
<p>As long as we stay with signals composed of one or more basis vectors, we can compute the DFT in this way. At the end of the chapter, we’ll develop code that will work for all signals, but first, let’s see if we can dive even deeper into the workings of the DFT. Three things we’ll want to explore:</p>
<ul>
<li><p>What would happen if frequencies changed – say, a melody were sung at a higher pitch?</p></li>
<li><p>What about amplitude changes – say, the music were played twice as loud?</p></li>
<li><p>What about phase – e.g., there were an offset before the piece started?</p></li>
</ul>
<p>In all cases, we’ll call <code>torch_fft_fft()</code> only once we’ve determined the result ourselves.</p>
<p>And finally, we’ll see how complex sinusoids, made up of different components, can still be analyzed in this way, provided they can be expressed in terms of the frequencies that make up the basis.</p>
</section>
<section id="varying-frequency" class="level3" data-number="26.1.3">
<h3 data-number="26.1.3" class="anchored" data-anchor-id="varying-frequency"><span class="header-section-number">26.1.3</span> Varying frequency</h3>
<p>Assume we quadrupled the frequency, giving us a signal that looked like this:</p>
<p><span class="math display">\[
\mathbf{x}_n = cos(\frac{2 \pi}{N}*4*n)
\]</span></p>
<p>Following the same logic as above, we can express it like so:</p>
<p><span class="math display">\[
\mathbf{x}_n = \frac{1}{2} (\mathbf{w}^{4n}_N + \mathbf{w}^{60n}_N)
\]</span></p>
<p>We already see that non-zero coefficients will be obtained only for frequency indices <span class="math inline">\(4\)</span> and <span class="math inline">\(60\)</span>. Picking the former, we obtain</p>
<p><span class="math display">\[
\begin{aligned}
X_4 &amp;= \langle \mathbf{w}^{4n}_N, \mathbf{x}_n \rangle \\
&amp;= \langle \mathbf{w}^{4n}_N, \frac{1}{2} (\mathbf{w}^{4n}_N + \mathbf{w}^{60n}_N) \rangle \\
&amp;= 32
\end{aligned}
\]</span></p>
<p>For the latter, we’d arrive at the same result.</p>
<p>Now, let’s make sure our analysis is correct. The following code snippet contains nothing new; it generates the signal, calculates the DFT, and plots them both (<a href="#fig-dft-cos-4-rev">fig.&nbsp;<span>26.3</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">torch_cos</span>(<span class="fu">frequency</span>(<span class="dv">4</span>, N) <span class="sc">*</span> sample_positions)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>plot_ft <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> sample_positions, <span class="at">y =</span> <span class="fu">as.numeric</span>(x))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  p_signal <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"time"</span>) <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"amplitude"</span>) <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># in the code, I'm using Ft instead of X because not</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># all operating systems treat variables as case-sensitive</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  Ft <span class="ot">&lt;-</span> <span class="fu">torch_fft_fft</span>(x)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  p_real <span class="ot">&lt;-</span> <span class="fu">create_plot</span>(</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    sample_positions,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    Ft<span class="sc">$</span>real,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"real part"</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  p_imag <span class="ot">&lt;-</span> <span class="fu">create_plot</span>(</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    sample_positions,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    Ft<span class="sc">$</span>imag,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"imaginary part"</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  p_magnitude <span class="ot">&lt;-</span> <span class="fu">create_plot</span>(</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    sample_positions,</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">torch_abs</span>(Ft),</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"magnitude"</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  p_phase <span class="ot">&lt;-</span> <span class="fu">create_plot</span>(</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    sample_positions,</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">phase</span>(Ft),</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"phase"</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>  (p_signal <span class="sc">|</span> <span class="fu">plot_spacer</span>()) <span class="sc">/</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>    (p_real <span class="sc">|</span> p_imag) <span class="sc">/</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    (p_magnitude <span class="sc">|</span> p_phase)</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ft</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-dft-cos-4-rev" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/dft-cos-4-rev.png" class="img-fluid figure-img" alt="Top row: A cosine function, going through y=1 four times. Middle row: Left: Real part. y=32 at x=4 and x=60. Right: Imaginary part. All y=0. Bottom row: Left: Magnitude. y=32 at x=4 and x=60. Right: Phase. All y=0."></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;26.3: A pure cosine that performs four revolutions over the sampling period, and its DFT. Imaginary parts and phases are still are zero.</figcaption><p></p>
</figure>
</div>
<p>This does indeed confirm our calculations.</p>
<p>A special case arises when signal frequency rises to the highest one “allowed”, in the sense of being detectable without aliasing. That will be the case at one half of the number of sampling points. Then, the signal will look like so:</p>
<p><span class="math display">\[
\mathbf{x}_n = \frac{1}{2} (\mathbf{w}^{32n}_N + \mathbf{w}^{32n}_N)
\]</span></p>
<p>Consequently, we end up with a single coefficient, corresponding to a frequency of 32 revolutions per sample period, of double the magnitude (64, thus). Here are the signal and its DFT (<a href="#fig-dft-cos-32-rev.png">fig.&nbsp;<span>26.4</span></a>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">torch_cos</span>(<span class="fu">frequency</span>(<span class="dv">32</span>, N) <span class="sc">*</span> sample_positions)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ft</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-dft-cos-32-rev.png" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/dft-cos-32-rev.png" class="img-fluid figure-img" alt="Top row: A cosine function, going through y=1 32 times. Middle row: Left: Real part. y=64 at x=32. Right: Imaginary part. All y=0. Bottom row: Left: Magnitude. y=64 at x=32. Right: Phase. All y=0."></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;26.4: A pure cosine that performs thirty-two revolutions over the sampling period, and its DFT. This is the highest frequency where, given sixty-four sample points, no aliasing will occur. Imaginary parts and phases still zero.</figcaption><p></p>
</figure>
</div>
</section>
<section id="varying-amplitude" class="level3" data-number="26.1.4">
<h3 data-number="26.1.4" class="anchored" data-anchor-id="varying-amplitude"><span class="header-section-number">26.1.4</span> Varying amplitude</h3>
<p>Now, let’s think about what happens when we vary amplitude. For example, say the signal gets twice as loud. Now, there will be a multiplier of 2 that can be taken outside the inner product. In consequence, the only thing that changes is the magnitude of the coefficients.</p>
<p>Let’s verify this. The modification is based on the example we had before the very last one, with four revolutions over the sampling period (<a href="#fig-dft-cos-mult-amplitude">fig.&nbsp;<span>26.5</span></a>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">torch_cos</span>(<span class="fu">frequency</span>(<span class="dv">4</span>, N) <span class="sc">*</span> sample_positions)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ft</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-dft-cos-mult-amplitude" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/dft-cos-mult-amplitude.png" class="img-fluid figure-img" alt="Top row: A cosine function, going through y=1 four times. Middle row: Left: Real part. y=64 at x=4 and x=60. Right: Imaginary part. All y=0. Bottom row: Left: Magnitude. y=64 at x=4 and x=60. Right: Phase. All y=0."></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;26.5: Pure cosine with four revolutions over the sampling period, and doubled amplitude. Imaginary parts and phases still zero.</figcaption><p></p>
</figure>
</div>
<p>So far, we have not once seen a coefficient with non-zero imaginary part. To change this, we add in <em>phase</em>.</p>
</section>
<section id="adding-phase" class="level3" data-number="26.1.5">
<h3 data-number="26.1.5" class="anchored" data-anchor-id="adding-phase"><span class="header-section-number">26.1.5</span> Adding phase</h3>
<p>Changing the phase of a signal means shifting it in time. Our example signal is a cosine, a function whose value is 1 at <span class="math inline">\(t=0\)</span>. (That also was the – arbitrarily chosen – starting point of the signal.)</p>
<p>Now assume we shift the signal forward by <span class="math inline">\(\frac{\pi}{2}\)</span>. Then the peak we were seeing at zero moves over to <span class="math inline">\(\frac{\pi}{2}\)</span>; and if we still start “recording” at zero, we must find a value of zero there. An equation describing this is the following. For convenience, we assume a sampling period of <span class="math inline">\(2 \pi\)</span> and <span class="math inline">\(k=1\)</span>, so that the example is a simple cosine:</p>
<p><span class="math display">\[
f(x) = cos(x - \phi)
\]</span></p>
<p>The minus sign may look unintuitive at first. But it does make sense: We now want to obtain a value of 1 at <span class="math inline">\(x=\frac{\pi}{2}\)</span>, so <span class="math inline">\(x - \phi\)</span> should evaluate to zero. (Or to any multiple of <span class="math inline">\(\pi\)</span>.) Summing up, a <em>delay</em> in time will appear as a <em>negative phase shift</em>.</p>
<p>Now, we’re going to calculate the DFT for a shifted version of our example signal. But if you like, take a peek at the phase-shifted version of the time-domain picture now already. You’ll see that a cosine, delayed by <span class="math inline">\(\frac{\pi}{2}\)</span>, is nothing else than a sine starting at 0.</p>
<p>To compute the DFT, we follow our familiar-by-now strategy. The signal now looks like this:</p>
<p><span class="math display">\[
\mathbf{x}_n = cos(\frac{2 \pi}{N}*4*x - \frac{\pi}{2})
\]</span></p>
<p>First, we express it in terms of basis vectors:</p>
<p><span class="math display">\[
\begin{aligned}
\mathbf{x}_n &amp;= cos(\frac{2 \pi}{64} 4 n - \frac{\pi}{2}) \\
&amp;= \frac{1}{2} (e^{i\frac{2 \pi}{64} 4n - \frac{pi}{2}} + e^{i\frac{2 \pi}{64} 60n - \frac{pi}{2}}) \\
&amp;= \frac{1}{2} (e^{i\frac{2 \pi}{64} 4n}  e^{-i \frac{\pi}{2}} + e^{i\frac{2 \pi}{64} 60n}  e^{i\frac{pi}{2}}) \\
&amp;= \frac{1}{2} (e^{-i \frac{\pi}{2}} \mathbf{w}^{4n}_N + e^{i \frac{\pi}{2}} \mathbf{w}^{60n}_N)
\end{aligned}
\]</span></p>
<p>Again, we have non-zero coefficients only for frequencies <span class="math inline">\(4\)</span> and <span class="math inline">\(60\)</span>. But they are complex now, and both coefficients are no longer identical. Instead, one is the complex conjugate of the other. First, <span class="math inline">\(X_4\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
X_4 &amp;= \langle \mathbf{w}^{4n}_N, \mathbf{x}_n \rangle \\
&amp;=\langle \mathbf{w}^{4n}_N, \frac{1}{2} (e^{-i \frac{\pi}{2}} \mathbf{w}^{4n}_N + e^{i \frac{\pi}{2}} \mathbf{w}^{60n}_N) \rangle\\
&amp;= 32 *e^{-i \frac{\pi}{2}} \\
&amp;= -32i
\end{aligned}
\]</span></p>
<p>And here, <span class="math inline">\(X_{60}\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
X_{60} &amp;= \langle \mathbf{w}^{60n}_N, \mathbf{x}_N \rangle \\
&amp;= 32 *e^{i \frac{\pi}{2}} \\
&amp;= 32i
\end{aligned}
\]</span></p>
<p>As usual, we check our calculation using <code>torch_fft_fft()</code> (<a href="#fig-dft-cos-phase-pi12">fig.&nbsp;<span>26.6</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">torch_cos</span>(<span class="fu">frequency</span>(<span class="dv">4</span>, N) <span class="sc">*</span> sample_positions <span class="sc">-</span> pi <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ft</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-dft-cos-phase-pi12" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/dft-cos-phase-pi12.png" class="img-fluid figure-img" alt="Top row: A sine function, going through y=1 four times. Middle row: Left: Real part. All y=0. Right: Imaginary part. y=-32 at x=4, y=32 at x=60. Bottom row: Left: Magnitude. y=32 at x=4. Right: Phase. y=pi/2 at x=4 and x=60."></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;26.6: Delaying a pure cosine wave by <span class="math inline">\(\pi/2\)</span> yields a pure sine wave. Now the real parts of all coefficients are zero; instead, non-zero imaginary values are appearing. The phase shift at those positions is <span class="math inline">\(\pi/2\)</span>.</figcaption><p></p>
</figure>
</div>
<p>For a pure sine wave, the non-zero Fourier coefficients are imaginary. The phase shift in the coefficients, reported as <span class="math inline">\(\frac{\pi}{2}\)</span>, reflects the time delay we applied to the signal.</p>
<p>Finally – before we write some code – let’s put it all together, and look at a wave that has more than a single sinusoidal component.</p>
</section>
<section id="superposition-of-sinusoids" class="level3" data-number="26.1.6">
<h3 data-number="26.1.6" class="anchored" data-anchor-id="superposition-of-sinusoids"><span class="header-section-number">26.1.6</span> Superposition of sinusoids</h3>
<p>The signal we construct may still be expressed in terms of the basis vectors, but it is no longer a pure sinusoid. Instead, it is a linear combination of such:</p>
<p><span class="math display">\[
\begin{aligned}
\mathbf{x}_n &amp;= 3 sin(\frac{2 \pi}{64} 4n) + 6 cos(\frac{2 \pi}{64} 2n) +2cos(\frac{2 \pi}{64} 8n)
\end{aligned}
\]</span></p>
<p>I won’t go through the calculation in detail, but it is no different from the previous ones. You compute the DFT for each of the three components, and assemble the results. Without any calculation, however, there’s quite a few things we can say:</p>
<ul>
<li>Since the signal consists of two pure cosines and one pure sine, there will be four coefficients with non-zero real parts, and two with non-zero imaginary parts. The latter will be complex conjugates of each other.</li>
<li>From the way the signal is written, it is easy to locate the respective frequencies, as well: The all-real coefficients will correspond to frequency indices 2, 8, 56, and 62; the all-imaginary ones to indices 4 and 60.</li>
<li>Finally, amplitudes will result from multiplying with <span class="math inline">\(\frac{64}{2}\)</span> the scaling factors obtained for the individual sinusoids.</li>
</ul>
<p>Let’s check (<a href="#fig-dft-mix-of-sinuisoids">fig.&nbsp;<span>26.7</span></a>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">*</span> <span class="fu">torch_sin</span>(<span class="fu">frequency</span>(<span class="dv">4</span>, N) <span class="sc">*</span> sample_positions) <span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">6</span> <span class="sc">*</span> <span class="fu">torch_cos</span>(<span class="fu">frequency</span>(<span class="dv">2</span>, N) <span class="sc">*</span> sample_positions) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span> <span class="sc">*</span> <span class="fu">torch_cos</span>(<span class="fu">frequency</span>(<span class="dv">8</span>, N) <span class="sc">*</span> sample_positions)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ft</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-dft-mix-of-sinuisoids" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/dft-mix-of-sinuisoids.png" class="img-fluid figure-img" alt="Top row: A function that is a composition of sinusoids. Middle row: Left: Real part. Non-zero at 2, 8, 56, and 62. Right: Imaginary part. Non-zero at 4 and 60. Bottom row: Left: Magnitude. Non-zero at 2, 4, 8, 56, 60, and 62. Right: Phase. Non-zero at 4 and 60."></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;26.7: Superposition of pure sinusoids, and its DFT.</figcaption><p></p>
</figure>
</div>
<p>Now, how do we calculate the DFT for less convenient signals?</p>
</section>
</section>
<section id="coding-the-dft" class="level2" data-number="26.2">
<h2 data-number="26.2" class="anchored" data-anchor-id="coding-the-dft"><span class="header-section-number">26.2</span> Coding the DFT</h2>
<p>Fortunately, we already know what has to be done. We want to project the signal onto each of the basis vectors. In other words, we’ll be computing a bunch of inner products. Logic-wise, nothing changes: The only difference is that in general, it will not be possible to represent the signal in terms of just a few basis vectors, like we did before. Thus, all projections will actually have to be calculated. But isn’t automation of tedious tasks one thing we have computers for?</p>
<p>Let’s start by stating input, output, and central logic of the algorithm to be implemented. As throughout this chapter, we stay in a single dimension. The input, thus, is a one-dimensional tensor, encoding a signal. The output is a one-dimensional vector of Fourier coefficients, of the same length as the input, each holding information about a frequency. The central idea is: To obtain a coefficient, project the signal onto the corresponding basis vector.</p>
<p>To implement that idea, we need to create the basis vectors, and for each one, compute its inner product with the signal. This can be done in a loop. Surprisingly little code is required to accomplish the goal:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dft <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  n_samples <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">torch_arange</span>(<span class="dv">0</span>, n_samples <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">$</span><span class="fu">unsqueeze</span>(<span class="dv">1</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  Ft <span class="ot">&lt;-</span> <span class="fu">torch_complex</span>(</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">torch_zeros</span>(n_samples), <span class="fu">torch_zeros</span>(n_samples)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>(n_samples <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    w_k <span class="ot">&lt;-</span> <span class="fu">torch_exp</span>(<span class="sc">-</span>1i <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">/</span> n_samples <span class="sc">*</span> k <span class="sc">*</span> n)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    dot <span class="ot">&lt;-</span> <span class="fu">torch_matmul</span>(w_k, x<span class="sc">$</span><span class="fu">to</span>(<span class="at">dtype =</span> <span class="fu">torch_cfloat</span>()))</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    Ft[k <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> dot</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  Ft</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To test the implementation, we can take the last signal we analysed, and compare with the output of <code>torch_fft_fft()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>Ft <span class="ot">&lt;-</span> <span class="fu">dft</span>(x)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">torch_round</span>(Ft<span class="sc">$</span>real) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">torch_round</span>(Ft<span class="sc">$</span>imag) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>[1]  0 0 192 0 0 0 0 0 64 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
[29] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 
[57] 64 0 0 0 0 0 192 0

[1]  0 0 0 0 -96 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
[29] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 
[57] 0 0 0 0 96 0 0 0</code></pre>
<p>Reassuringly – if you look back – the results are the same.</p>
<p>Above, did I say “little code”? In fact, a loop is not even needed. Instead of working with the basis vectors one-by-one, we can stack them in a matrix. Then each row will hold the conjugate of a basis vector, and there will be <span class="math inline">\(N\)</span> of them. The columns correspond to positions <span class="math inline">\(0\)</span> to <span class="math inline">\(N-1\)</span>; there will be <span class="math inline">\(N\)</span> of them as well. For example, this is how the matrix would look for <span class="math inline">\(N=4\)</span>:</p>
<p><span id="eq-dft-3"><span class="math display">\[
\mathbf{W}_4
=
\begin{bmatrix}
   e^{-i\frac{2 \pi}{4}* 0 * 0} &amp;   e^{-i\frac{2 \pi}{4}* 0 * 1}  &amp; e^{-i\frac{2 \pi}{4}* 0 * 2} &amp;  e^{-i\frac{2 \pi}{4}* 0 * 3}\\
e^{-i\frac{2 \pi}{4}* 1 * 0} &amp;   e^{-i\frac{2 \pi}{4}* 1 * 1}  &amp; e^{-i\frac{2 \pi}{4}* 1 * 2} &amp;  e^{-i\frac{2 \pi}{4}* 1 * 3}\\
e^{-i\frac{2 \pi}{4}* 2 * 0} &amp;   e^{-i\frac{2 \pi}{4}* 2 * 1}  &amp; e^{-i\frac{2 \pi}{4}* 2 * 2} &amp;  e^{-i\frac{2 \pi}{4}* 2 * 3}\\
e^{-i\frac{2 \pi}{4}* 3 * 0} &amp;   e^{-i\frac{2 \pi}{4}* 3 * 1}  &amp; e^{-i\frac{2 \pi}{4}* 3 * 2} &amp;  e^{-i\frac{2 \pi}{4}* 3 * 3}\\
\end{bmatrix}
\tag{26.3}\]</span></span></p>
<p>Or, evaluating the expressions:</p>
<p><span class="math display">\[
\mathbf{W}_4
=
\begin{bmatrix}
   1 &amp;   1  &amp; 1 &amp;  1\\
1 &amp;   -i  &amp; -1 &amp;  i\\
1 &amp;   -1  &amp; 1 &amp;  -1\\
1 &amp;   i  &amp; -1 &amp;  -i\\
\end{bmatrix}
\]</span></p>
<p>With that modification, the code looks a lot more elegant:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dft_vec <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  n_samples <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">torch_arange</span>(<span class="dv">0</span>, n_samples <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">$</span><span class="fu">unsqueeze</span>(<span class="dv">1</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">torch_arange</span>(<span class="dv">0</span>, n_samples <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">$</span><span class="fu">unsqueeze</span>(<span class="dv">2</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  mat_k_m <span class="ot">&lt;-</span> <span class="fu">torch_exp</span>(<span class="sc">-</span>1i <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">/</span> n_samples <span class="sc">*</span> k <span class="sc">*</span> n)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">torch_matmul</span>(mat_k_m, x<span class="sc">$</span><span class="fu">to</span>(<span class="at">dtype =</span> <span class="fu">torch_cfloat</span>()))</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As you can easily verify, the result is the same.</p>
<p>Before we move on to the next chapter – and the Fast Fourier Transform – we should test our implementation on something more complex.</p>
</section>
<section id="fun-with-sox" class="level2" data-number="26.3">
<h2 data-number="26.3" class="anchored" data-anchor-id="fun-with-sox"><span class="header-section-number">26.3</span> Fun with <code>sox</code></h2>
<p><a href="http://sox.sourceforge.net/"><code>sox</code></a> is a command line tool for processing audio, most often (I guess) used to quickly play some sound file, for resampling, or to convert between different file formats. However, it can <em>generate</em> sound, as well! (Admittedly, the syntax is not the most intuitive.) Here is the command I used in generating the test sound analysed below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sox</span> <span class="at">--combine</span> concatenate <span class="dt">\</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"|sox -r 4000 -n -p synth 0.2 </span><span class="dt">\</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="st">  sine 941 sine 1336 pinknoise remix -"</span> <span class="dt">\</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"|sox -r 4000 -n -p synth 0.2 </span><span class="dt">\</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="st">  sine 852 sine 1336 pinknoise remix - pad 0.15 0.15"</span> <span class="dt">\</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"|sox -r 4000 -n -p synth 0.2 </span><span class="dt">\</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="st">  sine 852 sine 1477 pinknoise remix -"</span> <span class="dt">\</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  resources/dft-dial.wav</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The result is a concatenation of three distinct sound events, of duration <code>0.2</code> seconds, separated by slightly shorter periods of silence (<code>pad 0.15 0.15</code>). Each sound event is a superposition of three components: two sine waves of different frequency, and pink noise. The frequency combinations used are not accidental: They represent the encoding of the numbers 0, 8, and 9 in the <a href="https://en.wikipedia.org/wiki/Dual-tone_multi-frequency_signaling">Dual-tone multi-frequency signaling (DTMF)</a> system, respectively.</p>
<p>For this signal, what would we expect to see in a spectrogram? We expect to see three distinct phases, clearly separated by “nothing”, that each show two dominant frequencies. The first and the second should have one frequency in common; the same holds for phases two and three. In addition, for all three phases, we should see contributions from all other frequencies, with lower frequencies having stronger impact than higher ones. (That’s what defines pink noise.)</p>
<p>At this point, allow me to call <code>sox</code> one last time. If you’ve been using that program before, did you know that it can create spectrograms? This one-liner uses all the default settings; yet the result has all the information we want (<a href="#fig-dft-spectrogram">fig.&nbsp;<span>26.8</span></a>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sox</span> resources/dial.wav <span class="at">-n</span> spectrogram <span class="dt">\ </span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-m</span> <span class="at">-l</span> <span class="at">-w</span> kaiser <span class="at">-o</span> dial-spectrogram.png</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-dft-spectrogram" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/dft-dial-spectrogram.png" class="img-fluid figure-img" alt="Spectrogram. There are three distinct phases. In each phase, two Fourier coefficients clearly dominate."></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;26.8: Spectrogram, created by <code>sox resources/dial.wav -n spectrogram -m -l -w kaiser -o dial-spectrogram.png</code>.</figcaption><p></p>
</figure>
</div>
<p>Now, let’s load this file into R, making use of <code>torchaudio</code>, a package we already know from the audio classification chapter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(torchaudio)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>wav <span class="ot">&lt;-</span> <span class="fu">tuneR_loader</span>(<span class="st">"resources/dft-dial.wav"</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>wav</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>WaveMC Object
  Number of Samples:      3600
  Duration (seconds):     0.9
  Samplingrate (Hertz):   4000
  Number of channels:     1
  PCM (integer format):   TRUE
  Bit (8/16/24/32/64):    32</code></pre>
<p>From all the information stored in <code>tuneR</code>’s <code>WaveMC</code> object, we need just the sampling rate and the data itself.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>waveform_and_sample_rate <span class="ot">&lt;-</span> <span class="fu">transform_to_tensor</span>(wav)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>waveform <span class="ot">&lt;-</span> waveform_and_sample_rate[[<span class="dv">1</span>]]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>sample_rate <span class="ot">&lt;-</span> waveform_and_sample_rate[[<span class="dv">2</span>]]</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(waveform)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>[1]    1 3600</code></pre>
<p>As expected, a plot of amplitude over time does not reveal too much (<a href="#fig-dft-dial-waveform">fig.&nbsp;<span>26.9</span></a>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(waveform)[<span class="dv">2</span>],</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">as.numeric</span>(waveform<span class="sc">$</span><span class="fu">squeeze</span>(<span class="dv">1</span>))</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"time"</span>) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"amplitude"</span>) <span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-dft-dial-waveform" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/dft-dial-waveform.png" class="img-fluid figure-img" alt="Three sound waves, clearly separated."></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;26.9: Three consecutive ringtones, time domain representation.</figcaption><p></p>
</figure>
</div>
<p>Now, we will compute the Fourier Transform – twice. First, with <code>torch_fft_fft()</code>, so we know the “truth”. Then, using our own <code>dft()</code>. For both, we will display the magnitudes of the lower half of the spectrum, that is, all frequencies up to the Nyquist rate. Finally, with help of <code>torch_fft_ifft()</code>, we will make sure we can regenerate the time domain representation from what <code>dft()</code> gave us.</p>
<p>In order to create a meaningful plot, there’s one additional step to be taken. So far, the magnitudes displayed in the frequency-domain plots have simply been ordered by <span class="math inline">\(k\)</span>, the index of the basis vector in question. In fact, there was no concept of a <em>real-world frequency</em>. But now, we want to see frequencies treated the way we conceptualize them: as number of cycles per second, measured in Hertz.</p>
<p>To be able to do the conversion, we need the sampling rate, which we already saw is 4000 Hertz. We then map the lower-half sample indices (<code>bins_below_nyquist</code>) to real-world frequencies, multiplying by the ratio of sampling rate to overall number of samples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>num_samples <span class="ot">&lt;-</span> <span class="fu">dim</span>(waveform)[<span class="dv">2</span>]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>nyquist_cutoff <span class="ot">&lt;-</span> num_samples <span class="sc">/</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>bins_below_nyquist <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>nyquist_cutoff</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>frequencies_per_bin <span class="ot">&lt;-</span> sample_rate <span class="sc">/</span> num_samples</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>real_world_frequencies <span class="ot">&lt;-</span> frequencies_per_bin <span class="sc">*</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  bins_below_nyquist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, then, is the magnitude plot for <code>torch_fft_fft()</code> (<a href="#fig-dft-dial-fft">fig.&nbsp;<span>26.10</span></a>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dial_fft <span class="ot">&lt;-</span> <span class="fu">torch_fft_fft</span>(waveform)<span class="sc">$</span><span class="fu">squeeze</span>()</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>p_magnitude <span class="ot">&lt;-</span> <span class="fu">create_plot</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  real_world_frequencies,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">torch_abs</span>(dial_fft)[<span class="dv">1</span><span class="sc">:</span>nyquist_cutoff], <span class="st">"magnitude"</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>p_magnitude</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-dft-dial-fft" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/dft-dial-fft.png" class="img-fluid figure-img" alt="Magnitudes of Fourier coefficients. No magnitude is zero. There are four peaks, all centers of bell-shaped curves."></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;26.10: DFT of the ringtone signal, computed by means of <code>torch_fft_fft()</code> . Displayed are the magnitudes of frequencies below the Nyquist rate.</figcaption><p></p>
</figure>
</div>
<p>The spectrum reflects the noise component in the signal, but the four peaks (which we know to be located at 852, 941, 1336, and 1477 Hertz) are clearly visible.</p>
<p>Now, does our hand-written code yield the same result (<a href="#fig-dft-dial-dft">fig.&nbsp;<span>26.11</span></a>)?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>dial_dft <span class="ot">&lt;-</span> <span class="fu">dft</span>(waveform<span class="sc">$</span><span class="fu">squeeze</span>())</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>p_magnitude <span class="ot">&lt;-</span> <span class="fu">create_plot</span>(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  real_world_frequencies,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">torch_abs</span>(dial_fft)[<span class="dv">1</span><span class="sc">:</span>nyquist_cutoff], <span class="st">"magnitude"</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>p_magnitude</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-dft-dial-dft" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/dft-dial-dft.png" class="img-fluid figure-img" alt="Magnitudes of Fourier coefficients. No magnitude is zero. There are four peaks, all centers of bell-shaped curves."></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;26.11: DFT of the ringtone signal, using our hand-written code. Displayed are the magnitudes of frequencies below the Nyquist rate.</figcaption><p></p>
</figure>
</div>
<p>It does. Finally, let’s use the Inverse DFT to recreate the signal (<a href="#fig-dft-dial-ifft">fig.&nbsp;<span>26.12</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>reconstructed <span class="ot">&lt;-</span> <span class="fu">torch_fft_ifft</span>(dial_dft)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span>num_samples,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">as.numeric</span>(reconstructed<span class="sc">$</span>real)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"time"</span>) <span class="sc">+</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"amplitude"</span>) <span class="sc">+</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-dft-dial-ifft" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/dft-dial-ifft.png" class="img-fluid figure-img" alt="Three sound waves, clearly separated."></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;26.12: Reconstruction of the time domain signal from the output of <code>dft()</code>.</figcaption><p></p>
</figure>
</div>
<p>And there we are. We’ve implemented the DFT ourselves, and learned quite a bit on our way. For the Fast Fourier Transform, the topic of the next chapter, the plan is exactly the same.</p>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Its counterpart – that takes the Fourier representation and yields a time-domain signal – is called <code>torch_fft_ifft()</code> (with <code>ifft</code> standing for <em>Inverse Fourier Transform</em>).<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Expanding on this a bit: For real-valued signals, the magnitudes as well as the real parts of corresponding coefficients are equal, while the phases and the imaginary parts are conjugated. In other words, the coefficients are complex conjugates of each other. We’ll see this in later examples.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>I’ll be writing <span class="math inline">\(\mathbf{x}_n\)</span> instead of <span class="math inline">\(f(x)\)</span> from now on to indicate that we’re working with discrete samples, not the continuous function itself.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Euler’s formula relates complex exponentials to sines and cosines, stating that <span class="math inline">\(e^{i \theta} = cos \theta + i sin \theta\)</span>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./matrix_computations_convolution.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Matrix computations: Convolution</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./fourier_transform_fft.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">The Fast Fourier Transform (FFT)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>